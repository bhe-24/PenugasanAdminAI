<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembayaran - Cendekia Aksara</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f4f6f9; font-family: 'Poppins', sans-serif; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; }
        .btn { display: inline-block; padding: 12px 25px; border-radius: 50px; text-decoration: none; font-weight: bold; margin-top: 15px; cursor: pointer; border: none; }
        .btn-blue { background: #003366; color: white; }
        .btn-gold { background: linear-gradient(135deg, #f2994a, #f2c94c); color: white; }
        .status-badge { padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" style="text-decoration:none; color:#666; display:block; margin-bottom:20px;">
            <i class="fa-solid fa-arrow-left"></i> Kembali ke Dashboard
        </a>

        <div id="loading" style="text-align:center; padding:50px;">
            <i class="fa-solid fa-spinner fa-spin" style="font-size:2rem; color:#003366;"></i>
        </div>

        <div id="content" class="card hidden">
            <h2 style="margin-top:0; color:#003366;">Status Administrasi</h2>
            <div style="margin: 20px 0;">
                <p style="color:#666; margin-bottom:5px;">Semester 3</p>
                <div id="status-display">-</div>
            </div>

            <div id="view-unpaid" class="hidden">
                <h1 style="color:#f2994a;">Rp 75.450</h1>
                <p>Silakan lakukan pembayaran agar bisa mencetak kartu ujian dan rapor.</p>
                <button onclick="document.getElementById('modal-qris').classList.remove('hidden')" class="btn btn-gold">
                    <i class="fa-solid fa-qrcode"></i> Bayar Sekarang
                </button>
            </div>

            <div id="view-paid" class="hidden">
                <i class="fa-solid fa-circle-check" style="font-size:4rem; color:#28a745; margin-bottom:15px;"></i>
                <h3 style="margin:0;">Pembayaran Tervrifikasi</h3>
                <p>Terima kasih telah menyelesaikan administrasi.</p>
                <a href="kwitansi.html" class="btn btn-blue">
                    <i class="fa-solid fa-file-invoice"></i> Lihat & Unduh Kwitansi
                </a>
            </div>
        </div>
    </div>

    <div id="modal-qris" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center;">
        <div style="background:white; padding:30px; border-radius:15px; width:90%; max-width:350px; text-align:center; position:relative;">
            <button onclick="document.getElementById('modal-qris').classList.add('hidden')" style="position:absolute; right:15px; top:10px; border:none; background:none; font-size:1.5rem;">&times;</button>
            <h3>Scan QRIS</h3>
            <img src="https://i.imgur.com/link_qris_kamu.png" style="width:100%; border-radius:10px;">
            <br><br>
            <a href="https://forms.gle/link_google_form_kamu" target="_blank" class="btn btn-gold">Upload Bukti</a>
        </div>
    </div>

    <script type="module">
        import { db, checkAuth } from "./js/firebase-config.js";
        
        (async () => {
            const user = await checkAuth('siswa');
            if(user) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');

                const status = user.statusPembayaran; // 'Lunas', 'Cicilan', atau null
                const badge = document.getElementById('status-display');

                if(status === 'Lunas' || status === 'Cicilan') {
                    badge.innerHTML = `<span class="status-badge" style="background:#d1e7dd; color:#0f5132;">${status === 'Lunas' ? 'LUNAS' : 'CICILAN AKTIF'}</span>`;
                    document.getElementById('view-paid').classList.remove('hidden');
                } else {
                    badge.innerHTML = `<span class="status-badge" style="background:#f8d7da; color:#842029;">BELUM LUNAS</span>`;
                    document.getElementById('view-unpaid').classList.remove('hidden');
                }
            }
        })();
    </script>
</body>
</html>
