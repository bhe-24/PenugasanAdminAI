<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Ujian</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background: #f4f7fe; color: #333; text-align: center; padding: 40px 20px; }
        .card { background: white; max-width: 500px; margin: 0 auto; padding: 40px; border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); }
        
        .score-circle {
            width: 150px; height: 150px; background: conic-gradient(#4361ee 0%, #e2e8f0 0%);
            border-radius: 50%; margin: 0 auto 25px; display: flex; justify-content: center; align-items: center;
            position: relative;
        }
        .score-inner { 
            width: 130px; height: 130px; background: white; border-radius: 50%; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
        }
        .score-val { font-size: 3rem; font-weight: 800; color: #003366; line-height: 1; }
        .score-label { font-size: 0.9rem; color: #64748b; }

        .stats { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; }
        .stat-item { background: #f8fafc; padding: 10px 20px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .st-val { font-weight: 700; font-size: 1.2rem; display: block; }
        .st-lbl { font-size: 0.8rem; color: #64748b; }

        .btn { display: block; width: 100%; padding: 15px; border-radius: 12px; font-weight: 600; text-decoration: none; margin-bottom: 10px; transition: 0.2s; }
        .btn-detail { background: #003366; color: white; }
        .btn-home { background: #e2e8f0; color: #475569; }
        .btn:hover { transform: translateY(-2px); opacity: 0.9; }
    </style>
</head>
<body>

    <div class="card">
        <i class="fa-solid fa-trophy" style="font-size:3rem; color:#f59e0b; margin-bottom:20px;"></i>
        <h2 style="margin:0 0 5px 0;">Ujian Selesai!</h2>
        <p style="color:#64748b; margin-bottom:30px;">Berikut adalah hasil pengerjaan Anda.</p>

        <div class="score-circle" id="chart">
            <div class="score-inner">
                <span class="score-val" id="score">0</span>
                <span class="score-label">NILAI</span>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <span class="st-val" id="correct" style="color:#10b981;">0</span>
                <span class="st-lbl">Benar</span>
            </div>
            <div class="stat-item">
                <span class="st-val" id="wrong" style="color:#ef4444;">0</span>
                <span class="st-lbl">Salah</span>
            </div>
        </div>

        <a href="#" id="link-detail" class="btn btn-detail">Lihat Pembahasan & Kunci</a>
        <a href="index.html" class="btn btn-home">Kembali ke Daftar Ujian</a>
    </div>

    <script type="module">
        import { db, checkAuth } from "../js/firebase-config.js";
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const rid = new URLSearchParams(window.location.search).get('rid');

        (async () => {
            if(!rid) return window.location.href = 'index.html';
            
            // Ambil Data Hasil
            const snap = await getDoc(doc(db, 'quiz_results', rid));
            if(!snap.exists()) return alert("Data hilang.");
            
            const r = snap.data();
            const wrong = r.totalQuestions - r.correctCount;

            // Render
            document.getElementById('score').innerText = r.score;
            document.getElementById('correct').innerText = r.correctCount;
            document.getElementById('wrong').innerText = wrong;
            
            // Set Link Pembahasan (Membawa RID yang sama)
            document.getElementById('link-detail').href = `detail.html?rid=${rid}`;

            // Animasi Chart
            const deg = (r.score / 100) * 360;
            document.getElementById('chart').style.background = `conic-gradient(#4361ee ${deg}deg, #e2e8f0 0deg)`;
        })();
    </script>
</body>
</html>
