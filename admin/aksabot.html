<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pusat Pengetahuan AksaBot - Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #003366; --bg: #f4f7fe; --accent: #11998e; }
        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 30px 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        
        .card { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }

        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px; grid-column: 1 / -1; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .header h2 { margin: 0; color: var(--primary); display: flex; align-items: center; gap: 10px; font-size: 1.6rem; }
        
        .info-box { background: #e0f2fe; color: #0284c7; padding: 15px 20px; border-radius: 8px; font-size: 0.95rem; margin-bottom: 20px; border-left: 5px solid #0ea5e9; line-height: 1.5; }
        
        textarea { width: 100%; height: 350px; padding: 20px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; line-height: 1.6; resize: vertical; transition: 0.3s; }
        textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(17, 153, 142, 0.1); }
        
        .btn { padding: 14px 25px; background: var(--accent); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; width: 100%; }
        .btn:hover { background: #0f857b; transform: translateY(-2px); }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; }
        .btn-back { background: #f1f5f9; color: #475569; width: auto; padding: 10px 20px; }
        .btn-back:hover { background: #e2e8f0; }

        /* ARSIP AREA */
        .arsip-container { max-height: 500px; overflow-y: auto; padding-right: 10px; }
        .arsip-item { background: #f8fafc; border: 1px solid #e2e8f0; padding: 20px; border-radius: 12px; margin-bottom: 15px; transition: 0.2s; }
        .arsip-item:hover { border-color: var(--primary); background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .arsip-date { font-size: 0.85rem; font-weight: bold; color: var(--primary); margin-bottom: 8px; display: block; border-bottom: 1px dashed #cbd5e1; padding-bottom: 5px; }
        .arsip-content { font-size: 0.95rem; color: #475569; line-height: 1.5; white-space: pre-wrap; }
        .empty-msg { text-align: center; color: #94a3b8; padding: 40px 20px; font-style: italic; }

        /* MODAL POPUP */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 2000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-box { background: white; padding: 35px 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; transform: scale(0.8) translateY(20px); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .modal-overlay.active .modal-box { transform: scale(1) translateY(0); }
        .modal-icon { font-size: 3.5rem; margin-bottom: 15px; color: var(--accent); }
        .modal-title { margin: 0 0 10px 0; color: var(--primary); font-size: 1.4rem; }
        .modal-text { color: #64748b; margin-bottom: 25px; line-height: 1.5; }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2><i class="fa-solid fa-brain"></i> Pusat Pengetahuan AksaBot</h2>
            <a href="index.html" class="btn btn-back"><i class="fa-solid fa-arrow-left"></i> Dashboard</a>
        </div>
        
        <div class="card">
            <h3 style="margin-top: 0; color: var(--primary); border-bottom: 2px dashed #eee; padding-bottom: 15px;"><i class="fa-solid fa-pen-to-square"></i> Tambah Informasi Baru</h3>
            <div class="info-box">
                Tuliskan informasi penting (Sejarah, Visi Misi, Aturan, dll). Data ini akan dikirim ke "Otak AI". Setelah disimpan, form ini akan kembali kosong dan datanya akan masuk ke daftar Arsip.
            </div>
            <textarea id="knowledge-input" placeholder="Ketik informasi tentang Cendekia Aksara di sini..."></textarea>
            
            <div style="margin-top: 20px;">
                <button id="btn-save" class="btn" onclick="saveKnowledge()"><i class="fa-solid fa-cloud-arrow-up"></i> Simpan ke Otak AI</button>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top: 0; color: var(--primary); border-bottom: 2px dashed #eee; padding-bottom: 15px; display: flex; justify-content: space-between;">
                <span><i class="fa-solid fa-box-archive"></i> Arsip Pengetahuan</span>
                <i class="fa-solid fa-spinner fa-spin" id="loading-arsip" style="color: #cbd5e1; display: none;"></i>
            </h3>
            <div class="arsip-container" id="arsip-list">
                <div class="empty-msg">Belum ada arsip pengetahuan.</div>
            </div>
        </div>
    </div>

    <div id="custom-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-icon" id="modal-icon"><i class="fa-solid fa-circle-check"></i></div>
            <h3 class="modal-title" id="modal-title">Sukses</h3>
            <div class="modal-text" id="modal-text">Data berhasil disimpan!</div>
            <button class="btn" onclick="closeModal()" style="width: auto; padding: 10px 30px;">Tutup</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyDpUWUIzPXIZN6rrNtsIqcL6VfOE2RLVl0", 
            authDomain: "mading-cf676.firebaseapp.com", 
            projectId: "mading-cf676", 
            storageBucket: "mading-cf676.firebasestorage.app", 
            messagingSenderId: "72175203671", 
            appId: "1:72175203671:web:7a0676a55beb64bc96ba12" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const knowledgeCol = collection(db, "aksabot_knowledge");

        // FUNGSI MODAL
        window.showModal = (type, title, text) => {
            const overlay = document.getElementById('custom-modal');
            const icon = document.getElementById('modal-icon');
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-text').innerText = text;
            
            if(type === 'error') {
                icon.innerHTML = '<i class="fa-solid fa-circle-xmark" style="color: #dc3545;"></i>';
            } else {
                icon.innerHTML = '<i class="fa-solid fa-circle-check" style="color: #11998e;"></i>';
            }
            overlay.classList.add('active');
        }
        window.closeModal = () => document.getElementById('custom-modal').classList.remove('active');


        // LOAD ARSIP
        async function loadArchive() {
            const listContainer = document.getElementById('arsip-list');
            const loader = document.getElementById('loading-arsip');
            
            loader.style.display = 'inline-block';
            
            try {
                // Urutkan dari yang terbaru
                const q = query(knowledgeCol, orderBy("createdAt", "desc"));
                const snap = await getDocs(q);
                
                listContainer.innerHTML = '';
                
                if (snap.empty) {
                    listContainer.innerHTML = '<div class="empty-msg">Belum ada arsip pengetahuan yang dimasukkan ke AI.</div>';
                } else {
                    snap.forEach(doc => {
                        const data = doc.data();
                        const date = data.createdAt ? data.createdAt.toDate().toLocaleString('id-ID', {day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute:'2-digit'}) : 'Baru saja';
                        
                        listContainer.innerHTML += `
                            <div class="arsip-item">
                                <span class="arsip-date"><i class="fa-regular fa-clock"></i> ${date} WIB</span>
                                <div class="arsip-content">${data.content}</div>
                            </div>
                        `;
                    });
                }
            } catch(e) {
                console.error(e);
                listContainer.innerHTML = '<div class="empty-msg" style="color: red;">Gagal memuat arsip.</div>';
            } finally {
                loader.style.display = 'none';
            }
        }

        // SIMPAN KE ARSIP
        window.saveKnowledge = async () => {
            const btn = document.getElementById('btn-save');
            const inputField = document.getElementById('knowledge-input');
            const content = inputField.value.trim();
            
            if (!content) {
                showModal('error', 'Form Kosong', 'Silakan ketikkan informasi terlebih dahulu sebelum menyimpan.');
                return;
            }

            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Sedang Menyimpan...';
            btn.disabled = true;
            
            try {
                // Tambahkan dokumen baru ke koleksi, bukan menimpanya
                await addDoc(knowledgeCol, { 
                    content: content, 
                    createdAt: serverTimestamp() 
                });
                
                showModal('success', 'Tersimpan!', 'Informasi baru telah ditambahkan ke "Otak" AksaBot.');
                inputField.value = ''; // Kosongkan form setelah sukses
                loadArchive(); // Refresh daftar arsip
                
            } catch(e) {
                showModal('error', 'Gagal', 'Terjadi kesalahan saat menyimpan data ke server.');
                console.error(e);
            } finally {
                btn.innerHTML = '<i class="fa-solid fa-cloud-arrow-up"></i> Simpan ke Otak AI';
                btn.disabled = false;
            }
        };

        // Init
        loadArchive();
    </script>
</body>
</html>
