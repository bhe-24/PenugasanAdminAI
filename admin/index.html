<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Cendekia Aksara</title>
    
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f6f9; margin: 0; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

        /* --- HEADER --- */
        .brand-header {
            background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
            color: white; padding: 25px; border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 31, 63, 0.3);
            display: flex; align-items: center; gap: 20px; margin-bottom: 30px;
            position: relative; overflow: hidden;
        }
        
        .brand-header::after {
            content: ''; position: absolute; top: -50%; right: -10%;
            width: 300px; height: 300px; background: rgba(255, 255, 255, 0.05);
            border-radius: 50%; pointer-events: none;
        }

        .header-logo-circle {
            width: 70px; height: 70px; background: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: #003366; font-size: 2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        .header-logo-circle img { width: 70%; height: auto; }

        .header-info { display: flex; flex-direction: column; justify-content: center; }
        .header-brand-name {
            font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 700;
            margin: 0; line-height: 1.1; letter-spacing: 0.5px;
        }
        .header-greeting {
            font-size: 1rem; opacity: 0.9; margin-top: 5px; font-weight: 400;
        }

        /* --- GRID MENU --- */
        .dashboard-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 20px;
        }

        .dashboard-card {
            padding: 25px; border-radius: 15px; color: white; text-align: center; text-decoration: none;
            transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            min-height: 140px; position: relative; overflow: hidden;
        }

        .dashboard-card:hover { transform: translateY(-5px); filter: brightness(1.1); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .dashboard-card i { font-size: 2.5rem; margin-bottom: 15px; }
        .dashboard-card h3 { font-size: 1.1rem; font-weight: 600; margin: 0; }

        /* Warna Menu */
        .card-tugas { background: linear-gradient(135deg, #005a9c, #007bff); }
        .card-nilai { background: linear-gradient(135deg, #6f42c1, #e83e8c); }
        .card-siswa { background: linear-gradient(135deg, #17a2b8, #20c997); }
        
        /* MENU BARU */
        .card-rapor { background: linear-gradient(135deg, #d63384, #fd7e14); } /* Pink-Orange */
        .card-biodata { background: linear-gradient(135deg, #11998e, #38ef7d); } /* Tosca-Green */
        
        .card-arsip { background: linear-gradient(135deg, #343a40, #6c757d); }
        .card-pustaka { background: linear-gradient(135deg, #fd7e14, #d63384); }
        .card-kuis { background: linear-gradient(135deg, #28a745, #17a2b8); }
        .card-ujian { background: linear-gradient(135deg, #f7a04a, #ffc107); }
        /* --- WARNA MENU PEMBAYARAN --- */
.card-bayar { 
    background: linear-gradient(135deg, #f2994a, #f2c94c); /* Warna Emas/Orange */
}

        #logout-btn {
            background-color: white; color: #dc3545; border: 1px solid #dc3545;
            padding: 10px 30px; border-radius: 50px; font-weight: 600;
            cursor: pointer; margin-top: 40px; transition: all 0.2s;
        }
        #logout-btn:hover { background-color: #dc3545; color: white; }

        @media (max-width: 480px) {
            .brand-header { padding: 20px; gap: 15px; }
            .header-brand-name { font-size: 1.4rem; }
            .dashboard-card { padding: 20px; min-height: 120px; }
        }

        /* --- MODAL LOGOUT STYLE --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px); /* Efek Blur */
            -webkit-backdrop-filter: blur(8px);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1; pointer-events: all;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 16px;
            text-align: center; width: 90%; max-width: 350px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        .modal-content i { font-size: 3rem; color: #dc3545; margin-bottom: 15px; }
        .modal-content h3 { margin: 10px 0 5px; color: #333; font-family: 'Playfair Display', serif; }
        .modal-content p { color: #666; margin-bottom: 25px; font-size: 0.95rem; }
        .modal-actions { display: flex; gap: 10px; justify-content: center; }
        
        .btn-confirm {
            background: #dc3545; color: white; border: none; padding: 10px 25px;
            border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .btn-confirm:hover { background: #b02a37; transform: translateY(-2px); }
        
        .btn-cancel {
            background: #f1f3f5; color: #333; border: none; padding: 10px 25px;
            border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .btn-cancel:hover { background: #e9ecef; }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="brand-header">
            <div class="header-logo-circle">
                <i class="fa-solid fa-graduation-cap"></i>
            </div>
            <div class="header-info">
                <h1 class="header-brand-name">Portal Admin</h1>
                <div id="admin-greeting" class="header-greeting"><i class="fa-solid fa-spinner fa-spin"></i> Memuat...</div>
            </div>
        </div>

        <div class="dashboard-grid">
            
            <a href="/admin/nilai.html" class="dashboard-card card-siswa">
                <i class="fa-solid fa-users-gear"></i> <h3>Input Nilai Siswa</h3>
            </a>
            
            <a href="/admin/siswa.html" class="dashboard-card card-siswa">
                <i class="fa-solid fa-users-gear"></i> <h3>Data Siswa</h3>
            </a>

            <a href="/admin/e_rapor.html" class="dashboard-card card-rapor">
                <i class="fa-solid fa-file-pdf"></i> <h3>E-Rapor Siswa</h3>
            </a>

            <a href="/admin/biodata_siswa.html" class="dashboard-card card-biodata">
                <i class="fa-solid fa-id-card-clip"></i> <h3>Biodata & Kontrol</h3>
            </a>
            
            <a href="/admin/tugas.html" class="dashboard-card card-tugas">
                <i class="fa-solid fa-pen-to-square"></i> <h3>Kelola Tugas</h3>
            </a>
            
            <a href="/admin/arsip.html" class="dashboard-card card-arsip">
                <i class="fa-solid fa-clock-rotate-left"></i> <h3>Log Aktivitas</h3>
            </a>
            <a href="/admin/keuangan.html" class="dashboard-card card-bayar">
    <i class="fa-solid fa-wallet"></i> 
    <h3>Keuangan</h3>
</a>

            <a href="https://bhe-24.github.io/PustakaMateri/" target="_blank" class="dashboard-card card-pustaka">
                <i class="fa-solid fa-book-atlas"></i> <h3>Pustaka Materi</h3>
            </a>

            <a href="https://bhe-24.github.io/PortalKuis/" target="_blank" class="dashboard-card card-kuis">
                <i class="fa-solid fa-list-check"></i> <h3>Kelola Kuis</h3>
            </a>

            <a href="/admin/ujian.html" class="dashboard-card card-ujian">
                <i class="fa-solid fa-file-signature"></i> <h3>Kelola Ujian</h3>
            </a>

        </div>

        <div style="text-align:center;">
            <button id="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Keluar</button>
        </div>
    </div>

    <div id="logout-modal" class="modal-overlay">
        <div class="modal-content">
            <i class="fa-solid fa-right-from-bracket"></i>
            <h3>Konfirmasi Keluar</h3>
            <p>Apakah Anda yakin ingin mengakhiri sesi admin ini?</p>
            <div class="modal-actions">
                <button id="btn-cancel-logout" class="btn-cancel">Batal</button>
                <button id="btn-confirm-logout" class="btn-confirm">Ya, Keluar</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Konfigurasi Firebase (Sesuaikan)
        const firebaseConfig = { 
            apiKey: "AIzaSyDpUWUIzPXIZN6rrNtsIqcL6VfOE2RLVl0", 
            authDomain: "mading-cf676.firebaseapp.com", 
            projectId: "mading-cf676", 
            storageBucket: "mading-cf676.firebasestorage.app", 
            messagingSenderId: "72175203671", 
            appId: "1:72175203671:web:7a0676a55beb64bc96ba12" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- CEK LOGIN (PENTING: Jangan Login Otomatis di Sini!) ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Jika user ada, ambil datanya
                try {
                    const docSnap = await getDoc(doc(db, "users", user.uid));
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        document.getElementById('admin-greeting').innerText = "Selamat Datang, " + (data.name || "Admin");
                    } else {
                        document.getElementById('admin-greeting').innerText = "Admin Panel";
                    }
                } catch(e) {
                    document.getElementById('admin-greeting').innerText = "Admin Panel";
                }
            } else {
                // PERBAIKAN: Jika tidak ada user (logout/belum login), TENDANG ke halaman login utama
                // Kita asumsikan index.html utama ada di folder luar (satu level di atas folder admin)
                window.location.href = "../index.html";
            }
        });

        // --- CUSTOM LOGOUT LOGIC ---
        const logoutBtn = document.getElementById('logout-btn');
        const modal = document.getElementById('logout-modal');
        const btnConfirm = document.getElementById('btn-confirm-logout');
        const btnCancel = document.getElementById('btn-cancel-logout');

        // Buka Modal
        logoutBtn.onclick = () => {
            modal.classList.add('active');
        };

        // Tutup Modal (Batal)
        btnCancel.onclick = () => {
            modal.classList.remove('active');
        };

        // Tutup jika klik di luar modal (overlay)
        modal.onclick = (e) => {
            if(e.target === modal) {
                modal.classList.remove('active');
            }
        };

        // Konfirmasi Logout
        btnConfirm.onclick = async () => {
            btnConfirm.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>'; // Loading icon
            try {
                await signOut(auth);
                // Redirect dilakukan otomatis oleh onAuthStateChanged di atas (blok else)
                // Tapi kita kasih backup manual ke root index.html
                window.location.href = "../index.html"; 
            } catch(e) {
                console.error(e);
                alert("Gagal logout.");
                btnConfirm.innerHTML = 'Ya, Keluar';
            }
        };
    </script>
</body>
</html>
