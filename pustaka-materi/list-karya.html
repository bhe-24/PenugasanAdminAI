<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karya - Pustaka Materi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        #search-container { transition: all 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <div class="min-h-screen relative pb-10">
        
        <!-- HEADER (Fixed / Paten) -->
        <div class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-blue-900 to-gray-900 shadow-lg rounded-b-2xl md:rounded-none">
            <div class="max-w-7xl mx-auto px-4 py-4 md:px-8">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <a href="index.html" class="text-white mr-4 p-2 hover:bg-white/10 rounded-full transition group">
                            <i class="fas fa-arrow-left text-lg group-hover:-translate-x-1 transition"></i>
                        </a>
                        <div>
                            <h1 class="text-yellow-400 font-bold text-lg uppercase tracking-wider md:text-xl">Semua Karya</h1>
                            <p class="text-blue-200 text-xs md:text-sm">Novel & Cerpen</p>
                        </div>
                    </div>
                    <button onclick="toggleSearch()" class="w-10 h-10 bg-white/10 rounded-full text-white hover:bg-white/20 transition flex items-center justify-center">
                        <i class="fas fa-search text-sm"></i>
                    </button>
                </div>
                
                <!-- Kolom Pencarian -->
                <div id="search-container" class="hidden mt-4">
                    <input type="text" id="search-input" onkeyup="handleSearch(this.value)" 
                        class="w-full px-4 py-2.5 rounded-lg border-none focus:ring-2 focus:ring-yellow-400 bg-white/95 text-gray-800 placeholder-gray-500 text-sm shadow-inner"
                        placeholder="Cari judul karya...">
                </div>
            </div>
        </div>

        <!-- Spacer untuk Header Fixed -->
        <div class="h-[80px] md:h-[90px]" id="header-spacer"></div>

        <!-- GRID CONTAINER -->
        <div class="max-w-7xl mx-auto px-4 py-6 md:px-8">
            <div id="grid-container" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6">
                <!-- Loading Skeleton -->
                <div class="h-[280px] bg-gray-200 rounded-xl animate-pulse"></div>
                <div class="h-[280px] bg-gray-200 rounded-xl animate-pulse"></div>
                <div class="h-[280px] bg-gray-200 rounded-xl animate-pulse hidden md:block"></div>
                <div class="h-[280px] bg-gray-200 rounded-xl animate-pulse hidden md:block"></div>
            </div>

            <!-- Pesan Kosong -->
            <div id="empty-msg" class="hidden text-center mt-20">
                <div class="inline-block p-4 bg-gray-100 rounded-full mb-4">
                    <i class="fas fa-book-open text-4xl text-gray-300"></i>
                </div>
                <p class="text-gray-500 text-sm font-medium">Tidak ada karya ditemukan.</p>
            </div>
        </div>

    </div>

    <!-- LOGIKA FIREBASE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query } 
        from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDooErB7K4vFtmC6-PcI30v82Vh6b85fPI",
            authDomain: "berbasis-ai.firebaseapp.com",
            projectId: "berbasis-ai",
            storageBucket: "berbasis-ai.firebasestorage.app",
            messagingSenderId: "962437652324",
            appId: "1:962437652324:web:4426a5efcabf72caebe471"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const COLLECTION_NAME = 'pustaka_materi';

        let allDataKarya = [];

        window.toggleSearch = () => {
            const container = document.getElementById('search-container');
            const spacer = document.getElementById('header-spacer');
            
            container.classList.toggle('hidden');
            
            // Adjust spacer height dynamically when search opens
            if(!container.classList.contains('hidden')) {
                document.getElementById('search-input').focus();
                spacer.style.height = "140px";
            } else {
                spacer.style.height = ""; // Reset to CSS default
            }
        }

        window.handleSearch = (val) => {
            const filtered = allDataKarya.filter(item => item.judul.toLowerCase().includes(val.toLowerCase()));
            renderGrid(filtered);
        }

        async function loadKarya() {
            try {
                const q = query(collection(db, COLLECTION_NAME));
                const snapshot = await getDocs(q);
                
                allDataKarya = [];
                snapshot.forEach(doc => {
                    const d = doc.data();
                    if(d.kategori === 'karya') allDataKarya.push(d);
                });

                allDataKarya.sort((a, b) => new Date(b.tanggal || 0) - new Date(a.tanggal || 0));
                
                renderGrid(allDataKarya);

            } catch (error) {
                console.error("Error:", error);
            }
        }

        function renderGrid(data) {
            const container = document.getElementById('grid-container');
            const emptyMsg = document.getElementById('empty-msg');
            container.innerHTML = '';

            if (data.length === 0) {
                emptyMsg.classList.remove('hidden');
                return;
            }
            emptyMsg.classList.add('hidden');

            data.forEach(item => {
                const card = `
                    <div class="flex flex-col bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition group h-full">
                        <!-- Cover Image -->
                        <div class="relative h-[220px] md:h-[260px] bg-gray-200 overflow-hidden">
                            <img src="${item.cover}" alt="${item.judul}" 
                                 class="w-full h-full object-cover transition duration-700 group-hover:scale-105"
                                 onerror="this.src='https://via.placeholder.com/200x300?text=No+Cover'">
                        </div>
                        
                        <!-- Content -->
                        <div class="p-3 md:p-4 flex flex-col flex-grow">
                            <h3 class="text-gray-800 font-bold text-xs md:text-sm leading-tight line-clamp-2 mb-3 min-h-[32px] md:min-h-[40px]">${item.judul}</h3>
                            
                            <!-- Tombol Unduh (Dibawah Judul) -->
                            <a href="${item.link}" class="mt-auto w-full bg-blue-900 text-yellow-400 text-xs font-bold py-2.5 rounded-lg text-center hover:bg-blue-800 transition shadow-sm flex items-center justify-center gap-2">
                                <i class="fas fa-download"></i> UNDUH
                            </a>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        loadKarya();
    </script>
</body>
</html>
