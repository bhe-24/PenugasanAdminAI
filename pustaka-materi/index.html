<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pustaka Materi - Cendekia Aksara</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        /* Animasi untuk search bar */
        #search-container { transition: all 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Wrapper Utama (Full Width di Desktop) -->
    <div class="min-h-screen relative pb-24">
        
        <!-- HEADER (Fixed / Paten) -->
        <div class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-br from-blue-900 to-gray-900 shadow-lg rounded-b-3xl md:rounded-b-none">
            <div class="max-w-7xl mx-auto p-5">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <img src="https://imgur.com/5Srjyo4.png" alt="Logo" class="w-12 h-12 object-cover rounded-full border-2 border-yellow-400 shadow-md">
                        <div>
                            <h1 class="text-yellow-400 font-extrabold text-xl tracking-wider uppercase leading-none">Pustaka Materi</h1>
                            <p class="text-blue-200 text-sm font-semibold tracking-wide">Cendekia Aksara</p>
                        </div>
                    </div>
                    <!-- Tombol Cari -->
                    <button onclick="toggleSearch()" class="w-10 h-10 bg-white/10 rounded-full text-white hover:bg-white/20 transition flex items-center justify-center">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <!-- Kolom Pencarian (Hidden by Default) -->
                <div id="search-container" class="hidden overflow-hidden mb-4">
                    <input type="text" id="search-input" onkeyup="handleSearch(this.value)" 
                        class="w-full px-4 py-3 rounded-xl border-none focus:ring-2 focus:ring-yellow-400 bg-white/95 text-gray-800 placeholder-gray-500 shadow-inner"
                        placeholder="Cari judul buku atau materi...">
                </div>

                <!-- Stats Info (Responsive Width) -->
                <div class="flex justify-around bg-white/10 backdrop-blur-sm rounded-xl p-3 text-center border border-white/10 max-w-md mx-auto md:max-w-lg">
                    <div>
                        <h3 class="text-white font-bold text-xl" id="count-karya">...</h3>
                        <p class="text-gray-300 text-[10px] uppercase tracking-widest">Karya</p>
                    </div>
                    <div class="w-px bg-gray-500/50"></div>
                    <div>
                        <h3 class="text-white font-bold text-xl" id="count-materi">...</h3>
                        <p class="text-gray-300 text-[10px] uppercase tracking-widest">Materi</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spacer untuk kompensasi Header Fixed -->
        <div class="h-[220px] md:h-[200px]"></div>

        <!-- Error Container -->
        <div id="error-container" class="hidden max-w-7xl mx-auto mt-4 px-5">
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative text-xs">
                <strong class="font-bold">Info:</strong> <span id="error-message"></span>
            </div>
        </div>

        <!-- CONTENT UTAMA -->
        <div id="main-content" class="max-w-7xl mx-auto">
            
            <!-- SECTION 1: KARYA -->
            <div class="mt-8 pl-5 md:pl-8 section-group">
                <div class="flex justify-between items-end pr-5 md:pr-8 mb-4">
                    <h2 class="text-blue-900 font-bold text-xl border-l-4 border-yellow-400 pl-3">Karya Terbaru</h2>
                    <a href="list-karya.html" class="text-sm text-gray-500 hover:text-blue-600 font-semibold group">
                        Lihat Semua <i class="fas fa-chevron-right text-[10px] group-hover:translate-x-1 transition"></i>
                    </a>
                </div>
                <!-- Horizontal Scroll -->
                <div id="container-karya" class="flex overflow-x-auto hide-scroll gap-5 pb-6 pr-5 md:pr-8 snap-x min-h-[300px]">
                    <div class="min-w-[160px] h-[240px] bg-gray-200 rounded-xl animate-pulse"></div>
                    <div class="min-w-[160px] h-[240px] bg-gray-200 rounded-xl animate-pulse"></div>
                </div>
            </div>

            <!-- SECTION 2: MATERI -->
            <div class="mt-4 pl-5 md:pl-8 section-group">
                <div class="flex justify-between items-end pr-5 md:pr-8 mb-4">
                    <h2 class="text-blue-900 font-bold text-xl border-l-4 border-yellow-400 pl-3">Materi Pilihan</h2>
                    <a href="list-materi.html" class="text-sm text-gray-500 hover:text-blue-600 font-semibold group">
                        Lihat Semua <i class="fas fa-chevron-right text-[10px] group-hover:translate-x-1 transition"></i>
                    </a>
                </div>
                <!-- Horizontal Scroll -->
                <div id="container-materi" class="flex overflow-x-auto hide-scroll gap-5 pb-6 pr-5 md:pr-8 snap-x min-h-[300px]">
                    <div class="min-w-[160px] h-[240px] bg-gray-200 rounded-xl animate-pulse"></div>
                    <div class="min-w-[160px] h-[240px] bg-gray-200 rounded-xl animate-pulse"></div>
                </div>
            </div>
        </div>

        <!-- FOOTER (Sticky Bottom / Menggantung) -->
        <div class="fixed bottom-6 left-0 right-0 max-w-[90%] md:max-w-md mx-auto z-40">
            <div class="bg-gray-900/85 backdrop-blur-md text-white py-3 px-6 rounded-full shadow-2xl flex justify-between items-center border border-white/10 ring-1 ring-white/20">
                <span class="text-[11px] font-medium tracking-wider">Â© 2026 Cendekia Aksara</span>
                <i class="fas fa-feather-alt text-yellow-400 text-sm"></i>
            </div>
        </div>

    </div>

    <!-- LOGIKA (FIREBASE + SEARCH) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query } 
        from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // === CONFIG FIREBASE ===
        const firebaseConfig = {
            apiKey: "AIzaSyDooErB7K4vFtmC6-PcI30v82Vh6b85fPI",
            authDomain: "berbasis-ai.firebaseapp.com",
            projectId: "berbasis-ai",
            storageBucket: "berbasis-ai.firebasestorage.app",
            messagingSenderId: "962437652324",
            appId: "1:962437652324:web:4426a5efcabf72caebe471"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const COLLECTION_NAME = 'pustaka_materi';
        
        let globalKarya = [];
        let globalMateri = [];

        // FUNGSI PENCARIAN & UI
        window.toggleSearch = () => {
            const container = document.getElementById('search-container');
            container.classList.toggle('hidden');
            if(!container.classList.contains('hidden')) {
                document.getElementById('search-input').focus();
            }
        }

        window.handleSearch = (keyword) => {
            const term = keyword.toLowerCase();
            
            const filteredKarya = globalKarya.filter(item => item.judul.toLowerCase().includes(term));
            const filteredMateri = globalMateri.filter(item => item.judul.toLowerCase().includes(term));

            renderScroll(filteredKarya, 'container-karya', 'list-karya.html');
            renderScroll(filteredMateri, 'container-materi', 'list-materi.html');
        }

        async function loadData() {
            try {
                const q = query(collection(db, COLLECTION_NAME));
                const snapshot = await getDocs(q);
                
                let allData = [];
                snapshot.forEach(doc => allData.push(doc.data()));

                allData.sort((a, b) => new Date(b.tanggal || 0) - new Date(a.tanggal || 0));

                globalKarya = allData.filter(item => item.kategori === 'karya');
                globalMateri = allData.filter(item => item.kategori === 'materi');

                document.getElementById('count-karya').innerText = globalKarya.length;
                document.getElementById('count-materi').innerText = globalMateri.length;

                renderScroll(globalKarya, 'container-karya', 'list-karya.html');
                renderScroll(globalMateri, 'container-materi', 'list-materi.html');

            } catch (error) {
                console.error(error);
                document.getElementById('error-container').classList.remove('hidden');
                document.getElementById('error-message').innerText = "Gagal memuat data. Cek koneksi internet.";
            }
        }

        function renderScroll(data, containerId, moreLink) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if(data.length === 0) {
                container.innerHTML = '<p class="text-sm text-gray-400 italic pr-5 whitespace-nowrap self-center">Tidak ditemukan.</p>';
                return;
            }

            // Render Card
            data.slice(0, 10).forEach(item => {
                const card = `
                    <div class="min-w-[160px] w-[160px] md:min-w-[180px] md:w-[180px] snap-start flex flex-col group">
                        
                        <!-- Gambar Cover -->
                        <div class="relative h-[230px] md:h-[260px] rounded-xl overflow-hidden shadow-md mb-3 bg-gray-200 border border-gray-100">
                            <img src="${item.cover}" alt="${item.judul}" 
                                 class="w-full h-full object-cover group-hover:scale-105 transition duration-500"
                                 onerror="this.src='https://via.placeholder.com/160x240?text=No+Cover'">
                        </div>

                        <!-- Judul -->
                        <h3 class="text-gray-800 font-bold text-sm leading-tight line-clamp-2 mb-2 min-h-[40px]">${item.judul}</h3>
                        
                        <!-- Tombol Unduh (Sekarang di bawah) -->
                        <a href="${item.link}" class="w-full bg-blue-900 text-yellow-400 text-xs font-bold py-2.5 px-3 rounded-lg text-center hover:bg-blue-800 transition shadow-sm flex items-center justify-center gap-2">
                            <i class="fas fa-download"></i> UNDUH
                        </a>
                    </div>
                `;
                container.innerHTML += card;
            });

            // Tombol Lihat Semua
            if(data.length > 10) {
                container.innerHTML += `
                    <a href="${moreLink}" class="min-w-[100px] flex flex-col items-center justify-center text-blue-900 snap-start hover:bg-blue-50 rounded-xl transition cursor-pointer border-2 border-dashed border-blue-200 ml-2">
                        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-2">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                        <span class="text-xs font-bold">Lihat Semua</span>
                    </a>
                `;
            }
        }

        loadData();
    </script>
</body>
</html>
